<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Premia√ß√£o Aisin</title>

<style>
body{
    font-family: Arial;
    background:#f2f2f2;
    display:flex;
    justify-content:center;
    padding:30px;
}

.card{
    background:white;
    padding:30px;
    width:700px;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}

input{
    padding:8px;
    margin:5px 0;
}

button{
    background:#f4b400;
    border:none;
    padding:8px 15px;
    cursor:pointer;
    margin-top:5px;
}

.section{
    margin-top:20px;
    border-top:1px solid #ccc;
    padding-top:15px;
}

ul{
    padding-left:18px;
}
.filter-box{
    background:#fafafa;
    padding:10px;
    margin-bottom:10px;
    border-radius:5px;
}
</style>
</head>

<body>

<div class="card">

<div id="login">
    <h2>Login</h2>
    <input type="text" id="matricula" placeholder="Digite sua matr√≠cula">
    <button onclick="login()">Entrar</button>
    <p id="erro" style="color:red;"></p>
</div>

<div id="painel" style="display:none;">
    <h2 id="nomeUsuario"></h2>
    <p><strong>Pontos:</strong> <span id="pontos"></span></p>

    <!-- HIST√ìRICO DE PONTOS -->
    <div class="section">
        <h3>üìú Hist√≥rico de Pontos</h3>

        <div class="filter-box">
            <strong>Filtros:</strong><br>
            Data: <input type="date" id="filtroDataPontos">
            Descri√ß√£o: <input type="text" id="filtroDescPontos" placeholder="Buscar descri√ß√£o">
            <button onclick="aplicarFiltroPontos()">Filtrar</button>
        </div>

        <ul id="historicoLista"></ul>
    </div>

    <!-- PR√äMIOS -->
    <div class="section">
        <h3>üèÜ Pr√™mios Dispon√≠veis</h3>
        <ul id="premiosLista"></ul>
    </div>

    <!-- RESGATES -->
    <div class="section">
        <h3>üéÅ Hist√≥rico de Resgates</h3>

        <div class="filter-box">
            <strong>Filtros:</strong><br>
            Data: <input type="date" id="filtroDataResgate">
            Brinde: <input type="text" id="filtroPremioResgate" placeholder="Buscar pr√™mio">
            <button onclick="aplicarFiltroResgates()">Filtrar</button>
        </div>

        <ul id="resgatesLista"></ul>
    </div>

    <div class="section">
        <button onclick="logout()">Sair</button>
    </div>
</div>

</div>

<script>

const usuariosURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3Qg8_1tUf-yYSyOGNHCH7f6S8rZ1zbB6CST2oM0QgaFdUX5kCD25mdtKSo4nAeOgHXWgO_Qd-UipH/pub?gid=0&single=true&output=csv";
const historicoURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3Qg8_1tUf-yYSyOGNHCH7f6S8rZ1zbB6CST2oM0QgaFdUX5kCD25mdtKSo4nAeOgHXWgO_Qd-UipH/pub?gid=1676923497&single=true&output=csv";
const resgatesURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3Qg8_1tUf-yYSyOGNHCH7f6S8rZ1zbB6CST2oM0QgaFdUX5kCD25mdtKSo4nAeOgHXWgO_Qd-UipH/pub?gid=1374780260&single=true&output=csv";
const premiosURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3Qg8_1tUf-yYSyOGNHCH7f6S8rZ1zbB6CST2oM0QgaFdUX5kCD25mdtKSo4nAeOgHXWgO_Qd-UipH/pub?gid=1841725743&single=true&output=csv";

let usuarios=[], historico=[], resgates=[], premios=[], usuarioAtual="";

function csvToArray(text){
    const rows = text.trim().split("\n");
    const headers = rows[0].split(",");
    return rows.slice(1).map(row=>{
        const values = row.split(",");
        let obj={};
        headers.forEach((h,i)=>{
            obj[h.trim()] = values[i]?values[i].trim():"";
        });
        return obj;
    });
}

async function carregarDados(){
    usuarios = csvToArray(await (await fetch(usuariosURL)).text());
    historico = csvToArray(await (await fetch(historicoURL)).text());
    resgates = csvToArray(await (await fetch(resgatesURL)).text());
    premios = csvToArray(await (await fetch(premiosURL)).text());
}

async function login(){
    const mat=document.getElementById("matricula").value;
    if(!mat){ alert("Digite sua matr√≠cula"); return;}
    await carregarDados();
    const user=usuarios.find(u=>u.Matricula===mat);
    if(!user){ alert("Matr√≠cula n√£o encontrada"); return;}
    usuarioAtual=mat;
    document.getElementById("login").style.display="none";
    document.getElementById("painel").style.display="block";
    document.getElementById("nomeUsuario").innerText=user.Nome || user.nome;
    document.getElementById("pontos").innerText=user.Pontos;
    mostrarHistorico();
    mostrarPremios();
    mostrarResgates();
}

function mostrarHistorico(lista=historico){
    const ul=document.getElementById("historicoLista");
    ul.innerHTML="";
    lista.filter(h=>h.Matricula===usuarioAtual)
         .forEach(h=>{
            ul.innerHTML+=`<li>${h.ID} - ${h.Data} - ${h.Descri√ß√£o} (${h.Pontos} pts)</li>`;
         });
}

function mostrarPremios(){
    const ul=document.getElementById("premiosLista");
    ul.innerHTML="";
    premios.filter(p=>p.Ativo==="Sim"||p.Ativo==="SIM")
           .forEach(p=>{
            ul.innerHTML+=`<li>${p["Nome Premio"]} - ${p["Pontos Necessarios"]} pts</li>`;
           });
}

function mostrarResgates(lista=resgates){
    const ul=document.getElementById("resgatesLista");
    ul.innerHTML="";
    lista.filter(r=>r.Matricula===usuarioAtual)
         .forEach(r=>{
            ul.innerHTML+=`<li>${r.Data} - ${r.Premio} (${r.Pontos} pts)</li>`;
         });
}

function aplicarFiltroPontos(){
    const data=document.getElementById("filtroDataPontos").value;
    const desc=document.getElementById("filtroDescPontos").value.toLowerCase();
    let filtrado=historico.filter(h=>h.Matricula===usuarioAtual);
    if(data) filtrado=filtrado.filter(h=>h.Data===data);
    if(desc) filtrado=filtrado.filter(h=>h.Descri√ß√£o.toLowerCase().includes(desc));
    mostrarHistorico(filtrado);
}

function aplicarFiltroResgates(){
    const data=document.getElementById("filtroDataResgate").value;
    const premio=document.getElementById("filtroPremioResgate").value.toLowerCase();
    let filtrado=resgates.filter(r=>r.Matricula===usuarioAtual);
    if(data) filtrado=filtrado.filter(r=>r.Data===data);
    if(premio) filtrado=filtrado.filter(r=>r.Premio.toLowerCase().includes(premio));
    mostrarResgates(filtrado);
}

function logout(){ location.reload(); }

</script>
</body>
</html>
